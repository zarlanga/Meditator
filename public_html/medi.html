<!DOCTYPE html>
<html>
    
    <head>
        <title>MEDITATOR</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body onkeydown="pruebakey(event)" onkeyup="pedo()" >

        <h1>Meditator</h1>
        
        <canvas id="myCanvas" width="400" height="400" onclick="calcular()"  style="border:1px solid;background-color: coral"></canvas>
        <p> presione cualquier tecla al inhalar y sueltela al exhalar, cuando termine presione el cuadro naranja </p>
        <script type="text/javascript">
            /* features
             -duracion de cada respiracion (listo)
             -respiraciones por minuto (cada cuanto calcularlas? como mostrarlas?)
             -tiempo total!
             -comparacion de inhalacion y exhalacion
             -graficar la duracion de la respiracion?
             -linea que baje y suba con la respiracion?
             -promedios de duracion de respiraciones y/o respiraciones por minutos (dividiendo la sesion en x partes?)
     
     
     
     
             */
            /* recuerdos var i = 0;
             var t0= Date.now(); 
     
             i++;
             alert(i +" //  "+  (Date.now() - t0) );  (en calcular)
     
             */

            var tiemposIN = [];
            var tiemposEX = []; 
            var dale = true;
            
            var c = document.getElementById("myCanvas");
            var ctx = c.getContext("2d");
            
            function graficarEX() {
                ctx.beginPath();
                ctx.lineWidth = "6";
                ctx.strokeStyle = "coral";
                ctx.rect(0, 200, 400, 200);
                
                //ctx.fillStyle = "coral";
                //ctx.fill();
                ctx.stroke();
                ctx.beginPath();
                
                ctx.strokeStyle = "red";
                ctx.rect(0, 0, 400, 200);
                //ctx.fillStyle = "red";
                //ctx.fill();
                ctx.stroke();
                
            }
            
            function graficarIN() {
                
                ctx.beginPath();
                ctx.lineWidth = "6";
                ctx.strokeStyle = "coral";
                ctx.rect(0, 0, 400, 200);
                //ctx.fillStyle = "coral";
                //ctx.fill();
                ctx.stroke();
                ctx.beginPath();
                ctx.strokeStyle = "red";
                ctx.rect(0, 200, 400, 200);
                
                //ctx.fillStyle = "red";
                //ctx.fill();
                ctx.stroke();
            
            }
            
            function limpiarGrafico() {
                ctx.beginPath();
                ctx.lineWidth = "6";
                ctx.strokeStyle = "coral";
                ctx.rect(0, 0, 400, 200);
                ctx.rect(0, 200, 400, 200);
                ctx.stroke();
            }

            function calcular() {
                
                var testo = "";
                limpiarGrafico();
                for (var p = 0; p < tiemposIN.length - 1; p++) {
                    tx = (tiemposIN[p + 1] - tiemposIN[p]);
                    testo += tx + "////" + (60000 / tx).toFixed(2) + "rpm\n";
                }
                testo += "total respiraciones: " + tiemposIN.length + "\n";
                testo += "tiempo total: " + ((tiemposIN[tiemposIN.length - 1] - tiemposIN[0]) / 1000) + "seg";
                alert(testo);
                
                tiemposIN = [];
                tiemposEX = [];
            }

            function pedo() {
                dale = true;
                tiemposEX[tiemposEX.length] = Date.now();
                graficarEX();
            }

            function pruebakey(e) {
                if (dale) {
                    tiemposIN[tiemposIN.length] = Date.now();
                    graficarIN();
                    dale = false;
                }

            }
            
            


        </script>
    </body>
</html>